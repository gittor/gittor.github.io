

# 目录

这篇文章包含以下几部分

* 基础概念的介绍，包括
  * 向量：向量的性质
  * 矩阵：矩阵的性质
  * 四元数：四元数的性质
  * 游戏中的坐标变换：游戏会使用哪几种坐标系
  * 线性代数中的概念：一些线性代数中的概念
* 对实践问题总结，包括
  * 平移：如何通过矩阵平移物体
  * 缩放：如何通过矩阵缩放物体
  * 旋转：如何通过矩阵旋转物体
  * 坐标系变换：如何在不同坐标系之间做相互转换
* 一些习题，可以供学习者检测自己是否掌握了足够的数学知识

# 向量

* 点乘
  * 计算公式
    * `P*Q=Px*Qx+Py*Qy+Pz*Qz`
    * `P*Q=|P|*|Q|*cosα`
  * 重要性质
    * 两个向量点乘结果等于0，等价于两向量垂直
    * 可以用来计算两向量夹角
    * 点乘不满足结合律：`(P*Q)*R != P*(Q*R)`
* 叉乘
  * 计算公式
    * `PXQ = (PyQz-PzQy, PzQx-PxQz, PxQy-PyQx)`
    * `|PXQ| = |P|*|Q|*sinα`
  * 几何意义
    * 求得同时与PQ垂直的向量，向量长度等于PQ所围成图形的面积，方向由右手定则确定。
  * 重要性质
    * 任意三个点围城的三角形面积=`½*|v2-v1|X|v3-v1|`
    * 叉乘不满足结合律：`P×Q×R != P×(Q×R)`
    * P×Q结果的方向，满足右手定则：四指由P指向Q，大拇指为结果方向。
* 投影
  * P在Q上的投影长度=`P*Q/|Q|`。由点乘的计算公式得到。
  * P在Q上的投影向量=`(P*Q/|Q|)*(Q/|Q|)`=`P在Q的投影长度*Q的单位向量`
* 行向量vs列向量
  * D3D使用的是行向量
  * OpenGL使用列向量

# 矩阵

* 几何意义：矩阵代表了可以改变物体空间属性的变换，通过矩阵
  * 可以对物体进行平移、缩放、旋转、切变、镜像。
  * 可以在求得同一物体在不同坐标系下的不同表示。
* 单位矩阵：主对角线上的元素都是1，其他元素都是0的方阵。
* 对角矩阵：只有主对角线上的元素非0，其他元素都是0的矩阵。
* 简约矩阵：
  * 所有非0的行，首元一定是1
  * 所有非0行都位于0行前面
  * 首元列的其他元素都是0
  * 前一行的首元一定比后一行的首元靠前
* 奇异矩阵：没有逆矩阵的矩阵。
  * 任何具有0行或0列的矩阵都是奇异矩阵，都没有逆矩阵
* 正交矩阵：矩阵中的每一列或每一行，都是单位正交向量。
  * 正交矩阵的逆矩阵=正交矩阵的转置矩阵
  * 旋转矩阵是正交的。
* 逆矩阵
  * M可逆<=>M的转置矩阵可逆
  * M可逆<=>det(M)!=0
  * `Inverse(FGM)=Inverse(M)*Inverse(G)*Inverse(F)`
  * 通过行列式求解：`Inverse(M)=M的标准伴随矩阵/det(M)`。
* 行列式
  * 行列式的大小，等于变换后，任意区域面积(体积)的有符号缩放倍数。
  * 只有方阵有行列式。
  * 如果行列式为0，则代表整个空间被压缩到了更低的维度。但仅通过行列式无法得知具体压缩到了几维。
  * 通过一系列规则求解
    * 交换矩阵两行，行列式变号
    * 给矩阵某一行乘以标量a，行列式变为a倍。
    * 将矩阵某一行的数倍加到另一行上，行列式的值不变。
  * 具有两个相同行(或相同列)的矩阵，行列式为0
  * det(FG)=det(F)*det(G)
* 矩阵的秩
  * 变换后的空间是几维的，矩阵的秩就是多少。
* 转置
  * `Transpose(FG)=Transpose(G)*Transpose(F)`
  * `Transpose(ABCD)=Transpose(D)*Transpose(C)*Transpose(B)*Transpose(A)`
* 乘法
  * 不满足交换律：`AB!=BA`
  * 满足结合律：
    * `(MF)G=M(FG)`
    * `ABCDEF=(AB)(CD)(EF)=ABCD(EF)`。任意位置加括号结果都是一样的
  * 向量与矩阵乘法满足分配率：`(v+w)*M=v*M+w*M`
* 克莱姆法则：可以用来求线性方程组的解。？？
* 矩阵变换
  * 反射变换：相对于某个轴，做镜像。
    * 奇数次反射变换，改变空间的偏手性；偶数次反射变换，等价于做旋转变换。
  * 如果矩阵的行列式小于0，则该矩阵包含一次反射变换。
  * 法向量变换矩阵=普通向量变换矩阵的逆转矩阵=`Transpose(Inverse(普通向量的变换矩阵))`
* **求变换矩阵**
  * 空间变换中，我们想解决两个问题：
    * 给定某个点和某个变换，想求得变换后的坐标，该如何构造这个变换矩阵
    * 给定A坐标系中的点，如何构造矩阵，使得该点乘以矩阵，就得到其在B中的坐标
  * 解决方案：
    * 第一个问题的矩阵为：矩阵的每一行（或每一列），都是原基变换后的坐标。
      * 记忆方式：任意向量的变换过程，等于基的变换过程。基变换对应的变换矩阵，就是任意向量的变换矩阵。
    * 第二个问题的矩阵为：矩阵的每一行（或每一列），都是A的基在B中的坐标。
      * 利用了`v'=x'i'+y'j'`，`i'=ai+bj;j'=ci+dj`两个公式，求得`v'=?i+?j`
      * 记忆方式：要知道源中任意点在目标中的表示，只需要知道源的基在目标中变成了多少。

# 四元数

* 四元数与轴角方式是等价的，绕轴A旋转α度的四元数=`(cos(α/2), A*sin(α/2))`
* 假设`q1=(w1,v1)`,`q2=(w2,v2)`
* 四元数乘法：`q1*q2=(w1*w2-v1*v2)+(w1*v2)+(w2*v1)+(v1×v2)`
  * 四元数乘法满足结合律，但不满足交换律。
  * q1*q2代表先进行q1旋转，再进行q2旋转。
* 共轭四元数：`q=(w,-v)`
  * 一个四元数与其共轭相乘，结果是一个实数，等于其长度的平方
* 单位四元数：`w*w+x*x+y*y+z*z=1`
  * 只有单位四元数才能表示三维旋转
* q和-q，代表相同的旋转。代表相互之间旋转了360度。
* q的逆变换=共轭(q)/|q|的平方
  * 由于|q|总是1，所以q的逆=q的共轭
* `Inverse(q1*q2*...*qn)=Inverse(qn)*Inverse(q2)*Inverse(q1)`
* 使用四元数旋转向量：先将v看做`[0,xi,yj,zk]`，然后应用：`v'=Inverse(q)*v*q`
* 四元数与矩阵互转：查询百度
* 球面差值：`q(t)=sin(1-t)α/sinα*q1+sintα/sinα*q2`
  * 其中α为q1和q2两向量的夹角=`acos(q1*q2/(|q1||q2|))`

# 3D旋转的几种方式

|        | 优点                               | 缺点                         |
| ------ | ---------------------------------- | ---------------------------- |
| 矩阵   | 有明确的规则可以立即对向量进行旋转 | 不符合人类的阅读习惯         |
| 欧拉角 | 符合人类阅读习惯                   | 有万向锁问题<br />求插值困难 |
| 四元数 | 插值方便                           |                              |
| 轴角   | 通常以四元数的形式出现             |                              |

# 线性代数中的一些概念

* 线性计算：只对向量做数乘和加法的计算。
  * 线性相关：一个向量处于其他向量张成空间上。即可以表示为其他向量的线性计算。
  * 线性无关：任意一个向量，都不在其他向量张成的空间上。
* 线性变换：
  * 直线在变换后仍为直线。
  * 原点的位置不变。
  * 由此得出，反射、旋转、缩放都是线性变换，平移不是线性变换。
  * 线性变换都可以表达为矩阵。
* 仿射变换：
  * 线性变换后接平移变换。仿射变换是线性变换的超集。
* 可逆变换：
  * 除投影外，其他的仿射变换都是可逆的。
  * 变换可逆<=>行列式不等于0
* 齐次矩阵vs非齐次矩阵：有平移的叫非齐次，没有平移的叫齐次。

# 旋转

* 2D绕点旋转，逆时针方向为正方向。
* 3D绕轴旋转，左手坐标系用左手判断正方向，右手坐标系用右手判断。大拇指指向旋转轴正方向，四指弯曲的方向就是旋转的正方向。

绕X轴的旋转矩阵：
$$
\begin{bmatrix}
1 & 0 & 0 \\
0 & cosθ & sinθ \\
0 & -sinθ & cosθ
\end{bmatrix}
$$
绕Y轴的旋转矩阵：
$$
\begin{bmatrix}
cosθ & 0 & -sinθ \\
0 & 1 & 0 \\
sinθ & 0 & cosθ
\end{bmatrix}
$$
绕Z轴的旋转矩阵：
$$
\begin{bmatrix}
cosθ & sinθ & 0 \\
-sinθ & cosθ & 0 \\
0 & 0 & 1
\end{bmatrix}
$$
绕任意向量n旋转θ角度的矩阵，n必须为单位向量：太复杂不给出。

# 缩放

沿坐标轴的缩放矩阵：
$$
\begin{bmatrix}
Kx & 0 & 0 \\
0 & Ky & 0 \\
0 & 0 & Kz
\end{bmatrix}
$$
沿任意轴的缩放矩阵：太复杂不给出。

# 投影

直接丢弃Z轴的投影矩阵：
$$
\begin{bmatrix}
1 & 0 & 0 \\
0 & 1 & 0 \\
0 & 0 & 0
\end{bmatrix}
$$
直接丢弃Y轴的投影矩阵：
$$
\begin{bmatrix}
1 & 0 & 0 \\
0 & 0 & 0 \\
0 & 0 & 1
\end{bmatrix}
$$
直接丢弃X轴的投影矩阵：
$$
\begin{bmatrix}
0 & 0 & 0 \\
0 & 1 & 0 \\
0 & 0 & 1
\end{bmatrix}
$$
向任意平面的平行投影：太复杂不给出。

# 镜像

镜像可以理解为缩放因子为-1的缩放

# 切变

切变的时候角度会发生变化，但是面积和体积不会发生变化。


# 游戏中的坐标变换

* 根本目的：将坐标从局部空间，变换到屏幕空间
* 过程：
  * 世界变换：局部空间->世界空间
  * 相机变换：世界空间->相机空间
  * 投影变换：相机空间->齐次空间。齐次空间的特点是xyz分量都属于[-1,1]。